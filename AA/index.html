<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antrian</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="config.js"></script>
</head>
<body>
	<!--KONTROL-->
    <header class="background-header">
        <a><b>RSUD Dr. H. MOH. ANWAR</b></a>
		<img src="../pustaka/LOGO-RSUDMA.png" alt="Logo" width="120">
        <a><b>KABUPATEN SUMENEP !!!</b></a>
    </header>
    <hr color="black">
    <hr color="black">
    <hr color="black">
    <header>
    <p><b>PASIEN RUJUK ATAU KONTROL</b></p>
    </header>

    <h2><span id="namaPoli"></span></h2>
	<h1 id="antrian"><b>A-300</b></h1>
    <h3><b>Nama : <span id="dataPatientName"></span></b></h3>
    <div class="flex-container">
        <p class="data-paragraph"><b>TELAH DILAYANI : <span id="dataPatientDone"></span></b></p>
        <p class="data-paragraph"><b>BELUM DILAYANI : <span id="dataPatientNoDone"></span></b></p>
    </div>
    <script src="../js/socketio.js"></script>
	<audio id="notificationSound" autoplay preload="auto"></audio>
    <footer>
        <p><b>JUMLAH PASIEN RUJUK ATAU KONTROL : <span id="dataPatient"></span></b></p>
    </footer>

    <!--RUJUKAN-->
    <hr color="black">
    <hr color="black">
    <hr color="black">
    <header class="background-header-rujuk">
        <p><b>PASIEN KONSUL POLI</b></p>
    </header>

    <h2><span id="namaPoliRujuk"></span></h2>
	<h1 id="antrianRujuk"><b>A-300</b></h1>
    <h3><b>Nama : <span id="dataPatientNameRujuk"></span></b></h3>
    <div class="flex-container">
        <p class="data-paragraph"><b>TELAH DILAYANI : <span id="dataPatientDoneRujuk"></span></b></p>
        <p class="data-paragraph"><b>BELUM DILAYANI : <span id="dataPatientNoDoneRujuk"></span></b></p>
    </div>
	<audio id="notificationSound" autoplay preload="auto"></audio>

    <footer class="background-footer-rujuk">
        <p><b>JUMLAH PASIEN KONSUL POLI : <span id="dataPatientRujuk"></span></b></p>
    </footer>


    <script>
        document.getElementById('namaPoli').textContent = dataIp.namaPoli.toUpperCase();
        document.getElementById('namaPoliRujuk').textContent = dataIp.namaPoli.toUpperCase();
        const socket = io(dataIp.ip, { transports: ['websocket'] });
		const audioElement = document.getElementById('notificationSound');

        socket.on('message', function (data) {
            if (data.namapoli == dataIp.namaPoli && data.status == 'kontrol') {
                console.error('========================== kontrol ===========================');
                document.getElementById('antrian').textContent = data.nomorAntrian;
                document.getElementById('dataPatient').textContent = data.dataPatient;
                document.getElementById('dataPatientDone').textContent = data.dataPatientDone;
                document.getElementById('dataPatientNoDone').textContent = data.dataPatientNoDone;
                document.getElementById('dataPatientName').textContent = data.patientName;

                const patientName = data.patientName;
                const namapoli = data.namapoli;
                const nomorAntrian = data.nomorAntrian;

                const teksAntrian = `${namapoli}. Nomor antrian ${nomorAntrian}. Atas nama ${patientName}`;

                playTextToSpeech(teksAntrian);
                
            }else if(data.namapoli == dataIp.namaPoli && data.status == 'rujuk'){
                console.error('========================== rujuk ===========================');
                document.getElementById('antrianRujuk').textContent = data.nomorAntrian;
                document.getElementById('dataPatientRujuk').textContent = data.dataPatient;
                document.getElementById('dataPatientDoneRujuk').textContent = data.dataPatientDone;
                document.getElementById('dataPatientNoDoneRujuk').textContent = data.dataPatientNoDone;
                document.getElementById('dataPatientNameRujuk').textContent = data.patientName;

                const patientName = data.patientName;
                const namapoli = data.namapoli;
                const nomorAntrian = data.nomorAntrian;

                const teksAntrian = `Rujukan : ${namapoli}. Nomor antrian ${nomorAntrian}. Atas nama ${patientName}`;

                playTextToSpeech(teksAntrian);
            }

            
        });

        function playTextToSpeech(text) {
            if (!isNaN(text)) {
                text = numberToWords(text);
            }

            if ('speechSynthesis' in window) {
                var synthesis = window.speechSynthesis;

                var utterance = new SpeechSynthesisUtterance(text);

                utterance.lang = 'id-ID';
                utterance.pitch = 1.2;
                utterance.volume = 1;

                var voices = synthesis.getVoices();
                const microsoftVoice = voices.find(voice => voice.lang === 'id-ID' && voice.name.includes('Microsoft'));
                const googleVoice = voices.find(voice => voice.lang === 'id-ID' && voice.name.includes('Google'));
                
                if (googleVoice) {
                    utterance.voice = googleVoice;
                } else if (microsoftVoice) {
                    utterance.voice = microsoftVoice;
                } else {
                    console.error('Suara Microsoft atau Google bahasa Indonesia tidak ditemukan. Menggunakan suara default.');
                }

                synthesis.speak(utterance);
            } else {
                alert('Maaf, browser Anda tidak mendukung SpeechSynthesis API.');
            }
        }

        function numberToWords(number) {
            var words = ['nol', 'satu', 'dua', 'tiga', 'empat', 'lima', 'enam', 'tujuh', 'delapan', 'sembilan'];
            var result = '';

            var digits = number.toString().split('').map(Number);

            for (var i = 0; i < digits.length; i++) {
                result += words[digits[i]] + ' ';
            }

            return result.trim();
        }
    </script>
</body>
</html>
