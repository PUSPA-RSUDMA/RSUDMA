<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antrian</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
	
    <header>
		
        <a><b>RSUD Dr. MOH. ANWAR</b></a>
		<img src="pustaka/LOGO-RSUDMA.png" alt="Logo" width="110">
        <p><b>KABUPATEN SUMENEP</b></p>
    </header>
	<h2 id="poli">POLI</h2>
	<h1 id="antrian"><b>A-100</b></h1>
	<p><b>JUMLAH PASIEN : <span id="dataPatient"></span></b></p>
    <script src="js/socketio.js"></script>
	<audio id="notificationSound" autoplay preload="auto"></audio>

    <script>
        const socket = io('http://192.168.34.211:3000', { transports: ['websocket'] });
		const audioElement = document.getElementById('notificationSound');

        socket.on('message', function(data) {
            if (data.namapoli == 'Poli VCT') {
                document.getElementById('poli').textContent = data.namapoli; 
				document.getElementById('antrian').textContent = data.nomorAntrian;
				document.getElementById('dataPatient').textContent = data.dataPatient;
				document.getElementById('dataPatientDone').textContent = data.dataPatientDone;
				document.getElementById('dataPatientNoDone').textContent = data.dataPatientNoDone;
				
            }
			
			const patientName = data.patientName;
			const namapoli = data.namapoli;
			const nomorAntrian = data.nomorAntrian;

			const teksAntrian = `${namapoli}, Nomor antrian ${nomorAntrian}, Atas nama ${patientName}`;

			playTextToSpeech(teksAntrian);
        });
		
		function playTextToSpeech(text) {
			if (!isNaN(text)) {
				text = numberToWords(text);
			}

			if ('speechSynthesis' in window) {
				var synthesis = window.speechSynthesis;

				var utterance = new SpeechSynthesisUtterance(text);

				utterance.lang = 'id-ID';
				
				utterance.pitch = 1; 
				utterance.volume = 0.9;
				
				var voices = synthesis.getVoices();
				var femaleVoice = voices.find(voice => voice.lang === 'id-ID' && voice.gender === 'female');
				console.log(voices); 
				if (femaleVoice) {
					utterance.voice = femaleVoice; 
				} else {
					console.log("Suara perempuan tidak ditemukan.");
				}

				synthesis.speak(utterance);
			} else {
				alert('Maaf, browser Anda tidak mendukung SpeechSynthesis API.');
			}
		}
		
		function numberToWords(number) {
			var words = ['nol', 'satu', 'dua', 'tiga', 'empat', 'lima', 'enam', 'tujuh', 'delapan', 'sembilan'];
			var result = '';

			var digits = number.toString().split('').map(Number);

			for (var i = 0; i < digits.length; i++) {
				result += words[digits[i]] + ' ';
			}

			return result.trim();
		}

		
    </script>

    <footer>
		<p><b>TELAH DILAYANI : <span id="dataPatientDone"></span></b></p>
		<p><b>BELOM DILAYANI : <span id="dataPatientNoDone"></span></b></p>
    </footer>
	
	<video autoplay muted loop id="video-footer">
        <source src="pustaka/video-layanan.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
</body>
</html>
