<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../css/style.css">
	<title>Display Antrian</title>
	<script src="config.js"></script>
</head>
<body>
	<header class="header">
		<img src="../pustaka/LOGO-RSUDMA.png" alt="Hospital Logo">
		<div class="header-text">
			<h1 class="hospital-name">RSUD Dr. H. Moh. Anwar</h1>
			<p class="location">KABUPATEN SUMENEP</p>
			<hr>
			<h2><span id="namaPoli"></span></h2>
		</div>
	</header>

	<div class="queue-display queue1" id="queue1">
		<h3>Pasien Rujuk Atau Kontrol</h3>
		<hr>
		<div class="queue-number" id="antrian">000</div>
			<div class="queue-info">
				<p class="text-pasien"><span id="dataPatientName"></span></p>
				<hr>
				<div class="flex-container">
					<div class="data-box">
						<p class="data-paragraph">Telah Dilayani : <span id="dataPatientDone"></span></p>
					</div>
					<div class="data-box2">
						<p class="data-paragraph">Belum Dilayani : <span id="dataPatientNoDone"></span></p>
					</div>
				</div>
				<div class="data-box3">
					<p>Jumlah Pasien : <span id="dataPatient"></span></p>
				</div>
			</div>
    	</div>
  	</div>

	<div class="queue-display queue2" id="queue2">
    	<h3>Pasien Konsul Poli</h3>
		<hr>
    	<div class="queue-number" id="antrianRujuk">000</div>
    		<div class="queue-info">
      			<p class="text-pasien"><span id="dataPatientNameRujuk"></span></p>
	  			<hr>
	  			<div class="flex-container">
					<div class="data-box">
						<p class="data-paragraph">Telah Dilayani : <span id="dataPatientDoneRujuk"></span></p>
					</div>
					<div class="data-box2">
						<p class="data-paragraph">Belum Dilayani : <span id="dataPatientNoDoneRujuk"></span></p>
					</div>
				</div>
				<div class="data-box3">
					<p>Jumlah Pasien : <span id="dataPatientRujuk"></span></p>
				</div>
    		</div>
   		</div>
  	</div>

	<script src="../js/socketio.js"></script>
    <!-- <script src="../js/responsivevoice.js"></script> -->
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=4XxtDSpw"></script>
	<audio id="notificationSound" autoplay preload="auto"></audio>

	<script>
        document.getElementById('namaPoli').textContent = dataIp.namaPoli.toUpperCase();
        const socket = io(dataIp.ip, { transports: ['websocket'] });
		const audioElement = document.getElementById('notificationSound');

        socket.on('message', function (data) {
            if (data.namapoli == dataIp.namaPoli && data.status == 'kontrol') {
                console.error('========================== kontrol ===========================');
                document.getElementById('antrian').textContent = data.nomorAntrian;
                document.getElementById('dataPatient').textContent = data.dataPatient;
                document.getElementById('dataPatientDone').textContent = data.dataPatientDone;
                document.getElementById('dataPatientNoDone').textContent = data.dataPatientNoDone;
                document.getElementById('dataPatientName').textContent = data.patientName.toUpperCase();

                const patientName = data.patientName;
                const namapoli = data.namapoli;
                const nomorAntrian = data.nomorAntrian.split('-');
                const spacedNomorAntrian = nomorAntrian[0].split('').join(' ');

                const teksAntrian = `${namapoli}. Nomor antrian ${spacedNomorAntrian}. ${nomorAntrian[1]}.  Atas nama. ${patientName}`;

                playTextToSpeechEspeak(teksAntrian);
                
            }else if(data.namapoli == dataIp.namaPoli && data.status == 'rujuk'){
                console.error('========================== rujuk ===========================');
                document.getElementById('antrianRujuk').textContent = data.nomorAntrian;
                document.getElementById('dataPatientRujuk').textContent = data.dataPatient;
                document.getElementById('dataPatientDoneRujuk').textContent = data.dataPatientDone;
                document.getElementById('dataPatientNoDoneRujuk').textContent = data.dataPatientNoDone;
                document.getElementById('dataPatientNameRujuk').textContent = data.patientName.toUpperCase();

                const patientName = data.patientName;
                const namapoli = data.namapoli;
                const namapoliRujuk = data.namapoliRujuk;
                const nomorAntrian = data.nomorAntrian.split('-');
                const spacedNomorAntrian = nomorAntrian[0].split('').join(' ');

                const teksAntrian = `rujuk internal. ${namapoliRujuk}. ke ${namapoli}. Nomor antrian ${spacedNomorAntrian}.${nomorAntrian[1]}. Atas nama ${patientName}`;

                playTextToSpeechEspeak(teksAntrian);
            }

            
        });

        // function playTextToSpeechEspeak(text) {
        //     const googleTTSURL = 'https://translate.googleapis.com/translate_tts?ie=UTF-8&tl=id-ID&client=tw-ob&q=' + encodeURIComponent(text);
        //     audioElement.src = googleTTSURL;
        // }

        function playTextToSpeechEspeak(text) {
            if (!isNaN(text)) {
                text = numberToWords(text);
            }
			var spacedText = text.split(' ').join('   ');
            responsiveVoice.speak(spacedText, 'Indonesian Female', { rate: 0.8,pitch: 1.2 });
        }
        
        function numberToWords(number) {
            var words = ['nol', 'satu', 'dua', 'tiga', 'empat', 'lima', 'enam', 'tujuh', 'delapan', 'sembilan'];
            var result = '';

            var digits = number.toString().split('').map(Number);

            for (var i = 0; i < digits.length; i++) {
                result += words[digits[i]] + ' ';
            }

            return result.trim();
        }
    </script>
</body>
</html>
